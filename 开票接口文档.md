# 开票接口文档

## 目录
2. [发票抬头管理接口](#2-发票抬头管理接口)
3. [开票订单接口](#3-开票订单接口)
4. [开票申请接口](#4-开票申请接口)
5. [开票历史接口](#5-开票历史接口)

---


---

## 2. 发票抬头管理接口

### 2.1 获取默认发票抬头

**接口地址**: `GET /invoice/header/default`

**接口描述**: 获取当前用户的默认发票抬头信息

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| userId | String | 是 | 用户ID |

**响应示例**:
```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "id": "header_001",
    "headerType": "enterprise",
    "companyName": "测试企业有限公司",
    "taxNumber": "91350100MA31234567",
    "invoiceType": "normal",
    "companyAddress": "福建省福州市台江区测试路123号",
    "companyPhone": "0591-12345678",
    "bankName": "中国建设银行福州分行",
    "bankAccount": "35001234567890123456",
    "customerName": "",
    "email": "test@company.com",
    "contactPhone": "13800138000",
    "isDefault": true,
    "createTime": "2024-01-01 10:00:00",
    "updateTime": "2024-01-01 10:00:00"
  }
}
```

### 2.2 获取发票抬头列表

**接口地址**: `GET /invoice/header/list`

**接口描述**: 获取当前用户的所有发票抬头列表

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| userId | String | 是 | 用户ID |

**响应示例**:
```json
{
  "code": 200,
  "msg": "success",
  "data": [
    {
      "id": "header_001",
      "headerType": "enterprise",
      "companyName": "测试企业有限公司",
      "taxNumber": "91350100MA31234567",
      "invoiceType": "normal",
      "companyAddress": "",
      "companyPhone": "",
      "bankName": "",
      "bankAccount": "",
      "customerName": "",
      "email": "test@company.com",
      "contactPhone": "13800138000",
      "isDefault": true,
      "createTime": "2024-01-01 10:00:00",
      "updateTime": "2024-01-01 10:00:00"
    },
    {
      "id": "header_002",
      "headerType": "personal",
      "companyName": "",
      "taxNumber": "",
      "invoiceType": "normal",
      "companyAddress": "",
      "companyPhone": "",
      "bankName": "",
      "bankAccount": "",
      "customerName": "张三",
      "email": "zhangsan@email.com",
      "contactPhone": "13900139000",
      "isDefault": false,
      "createTime": "2024-01-02 10:00:00",
      "updateTime": "2024-01-02 10:00:00"
    }
  ]
}
```

### 2.3 创建发票抬头

**接口地址**: `POST /invoice/header/create`

**接口描述**: 创建新的发票抬头

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| userId | String | 是 | 用户ID |
| headerType | String | 是 | 抬头类型：enterprise(企业单位)/personal(个人/非企业) |
| companyName | String | 否 | 公司名称（企业单位必填） |
| taxNumber | String | 否 | 纳税人识别号（企业单位必填） |
| invoiceType | String | 否 | 发票类型：normal(普票)/special(专票)（企业单位必填） |
| companyAddress | String | 否 | 公司地址（专票必填） |
| companyPhone | String | 否 | 公司电话（专票必填） |
| bankName | String | 否 | 开户银行（专票必填） |
| bankAccount | String | 否 | 银行账户（专票必填） |
| customerName | String | 否 | 客户姓名（个人/非企业必填） |
| email | String | 是 | 电子邮箱 |
| contactPhone | String | 是 | 联系电话 |
| isDefault | Boolean | 否 | 是否设为默认（默认false） |

**请求示例**:
```json
{
  "userId": "user_001",
  "headerType": "enterprise",
  "companyName": "测试企业有限公司",
  "taxNumber": "91350100MA31234567",
  "invoiceType": "special",
  "companyAddress": "福建省福州市台江区测试路123号",
  "companyPhone": "0591-12345678",
  "bankName": "中国建设银行福州分行",
  "bankAccount": "35001234567890123456",
  "email": "test@company.com",
  "contactPhone": "13800138000",
  "isDefault": true
}
```

**响应示例**:
```json
{
  "code": 200,
  "msg": "创建成功",
  "data": {
    "id": "header_003"
  }
}
```

### 2.4 更新发票抬头

**接口地址**: `POST /invoice/header/update`

**接口描述**: 更新已有的发票抬头

**请求参数**: 与创建接口相同，但需要额外传入id

**请求示例**:
```json
{
  "id": "header_001",
  "userId": "user_001",
  "headerType": "enterprise",
  "companyName": "更新后的企业名称",
  "taxNumber": "91350100MA31234567",
  "invoiceType": "normal",
  "email": "updated@company.com",
  "contactPhone": "13800138000",
  "isDefault": false
}
```

**响应示例**:
```json
{
  "code": 200,
  "msg": "更新成功",
  "data": null
}
```

### 2.5 删除发票抬头

**接口地址**: `POST /invoice/header/delete`

**接口描述**: 删除指定的发票抬头

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| headerId | String | 是 | 抬头ID |
| userId | String | 是 | 用户ID |

**请求示例**:
```json
{
  "headerId": "header_001",
  "userId": "user_001"
}
```

**响应示例**:
```json
{
  "code": 200,
  "msg": "删除成功",
  "data": null
}
```

### 2.6 设置默认发票抬头

**接口地址**: `POST /invoice/header/setDefault`

**接口描述**: 将指定抬头设为默认抬头

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| headerId | String | 是 | 抬头ID |
| userId | String | 是 | 用户ID |

**请求示例**:
```json
{
  "headerId": "header_002",
  "userId": "user_001"
}
```

**响应示例**:
```json
{
  "code": 200,
  "msg": "设置成功",
  "data": null
}
```

---

## 3. 开票订单接口

### 3.1 获取可开票订单列表

**接口地址**: `GET /invoice/orders`

**接口描述**: 获取指定时间范围内可开票的订单列表

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| userId | String | 是 | 用户ID |
| startDate | String | 是 | 开始日期（YYYY-MM-DD） |
| endDate | String | 是 | 结束日期（YYYY-MM-DD） |

**响应示例**:
```json
{
  "code": 200,
  "msg": "success",
  "data": [
    {
      "orderId": "order_001",
      "stationName": "某某充电站",
      "stationId": "station_001",
      "gunNo": "1",
      "chargeDegree": 25.5,
      "chargeAmount": 38.25,
      "chargeTime": 45,
      "createTime": "2024-01-15 14:30:00",
      "endTime": "2024-01-15 15:15:00",
      "status": "completed",
      "canInvoice": true
    },
    {
      "orderId": "order_002",
      "stationName": "另一个充电站",
      "stationId": "station_002", 
      "gunNo": "3",
      "chargeDegree": 30.2,
      "chargeAmount": 45.30,
      "chargeTime": 60,
      "createTime": "2024-01-16 09:00:00",
      "endTime": "2024-01-16 10:00:00",
      "status": "completed",
      "canInvoice": true
    }
  ]
}
```

**响应参数说明**:
| 字段名 | 类型 | 说明 |
|--------|------|------|
| orderId | String | 订单ID |
| stationName | String | 充电站名称 |
| stationId | String | 充电站ID |
| gunNo | String | 充电枪号 |
| chargeDegree | Number | 充电度数 |
| chargeAmount | Number | 充电金额 |
| chargeTime | Number | 充电时长（分钟） |
| createTime | String | 订单创建时间 |
| endTime | String | 充电结束时间 |
| status | String | 订单状态 |
| canInvoice | Boolean | 是否可开票 |

---

## 4. 开票申请接口

### 4.1 提交开票申请

**接口地址**: `POST /invoice/apply`

**接口描述**: 提交开票申请

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| orderIds | Array | 是 | 订单ID数组 |
| headerType | String | 是 | 抬头类型 |
| headerId | String | 是 | 发票抬头ID |

**请求示例**:
```json
{
  "orderIds": ["order_001", "order_002", "order_003"],
  "headerType": "enterprise",
  "headerId": "header_001"
}
```

**响应示例**:
```json
{
  "code": 200,
  "msg": "开票申请提交成功",
  "data": {
    "invoiceId": "invoice_001",
    "invoiceNo": "INV202401150001",
    "totalAmount": 123.55,
    "orderCount": 3,
    "estimatedTime": "1-3个工作日"
  }
}
```

**响应参数说明**:
| 字段名 | 类型 | 说明 |
|--------|------|------|
| invoiceId | String | 开票申请ID |
| invoiceNo | String | 开票申请编号 |
| totalAmount | Number | 开票总金额 |
| orderCount | Number | 订单数量 |
| estimatedTime | String | 预计开票时间 |

---

## 5. 开票历史接口

### 5.1 获取开票历史列表

**接口地址**: `GET /invoice/history`

**接口描述**: 获取用户的开票历史记录

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| userId | String | 是 | 用户ID |
| startDate | String | 是 | 开始日期（YYYY-MM-DD） |
| endDate | String | 是 | 结束日期（YYYY-MM-DD） |

**响应示例**:
```json
{
  "code": 200,
  "msg": "success",
  "data": [
    {
      "invoiceId": "invoice_001",
      "invoiceNo": "INV202401150001",
      "companyName": "测试企业有限公司",
      "taxNumber": "91350100MA31234567",
      "headerType": "enterprise",
      "invoiceType": "normal",
      "totalAmount": 123.55,
      "orderCount": 3,
      "status": "completed",
      "pdfUrl": "https://example.com/invoices/INV202401150001.pdf",
      "createTime": "2024-01-15 16:30:00",
      "completeTime": "2024-01-16 10:00:00",
      "orders": [
        {
          "orderId": "order_001",
          "stationName": "某某充电站",
          "chargeDegree": 25.5,
          "chargeAmount": 38.25,
          "createTime": "2024-01-15 14:30:00"
        },
        {
          "orderId": "order_002", 
          "stationName": "另一个充电站",
          "chargeDegree": 30.2,
          "chargeAmount": 45.30,
          "createTime": "2024-01-16 09:00:00"
        },
        {
          "orderId": "order_003",
          "stationName": "第三个充电站",
          "chargeDegree": 26.8,
          "chargeAmount": 40.00,
          "createTime": "2024-01-16 11:00:00"
        }
      ]
    },
    {
      "invoiceId": "invoice_002",
      "invoiceNo": "INV202401160001",
      "companyName": "",
      "taxNumber": "",
      "headerType": "personal",
      "customerName": "张三",
      "invoiceType": "normal",
      "totalAmount": 88.90,
      "orderCount": 2,
      "status": "processing",
      "pdfUrl": null,
      "createTime": "2024-01-16 14:20:00",
      "completeTime": null,
      "orders": [
        {
          "orderId": "order_004",
          "stationName": "测试充电站",
          "chargeDegree": 20.0,
          "chargeAmount": 30.00,
          "createTime": "2024-01-16 12:00:00"
        },
        {
          "orderId": "order_005",
          "stationName": "另一个测试站",
          "chargeDegree": 35.6,
          "chargeAmount": 58.90,
          "createTime": "2024-01-16 13:30:00"
        }
      ]
    }
  ]
}
```

**响应参数说明**:
| 字段名 | 类型 | 说明 |
|--------|------|------|
| invoiceId | String | 开票申请ID |
| invoiceNo | String | 开票申请编号 |
| companyName | String | 公司名称（企业单位） |
| customerName | String | 客户姓名（个人/非企业） |
| taxNumber | String | 纳税人识别号 |
| headerType | String | 抬头类型 |
| invoiceType | String | 发票类型 |
| totalAmount | Number | 开票总金额 |
| orderCount | Number | 订单数量 |
| status | String | 开票状态：pending(申请中)/processing(开票中)/completed(已开票)/rejected(已拒绝) |
| pdfUrl | String | PDF文件下载链接（已开票时才有） |
| createTime | String | 申请时间 |
| completeTime | String | 完成时间 |
| orders | Array | 订单详情列表 |

---

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| 200 | 成功 |
| 400 | 请求参数错误 |
| 401 | 未授权 |
| 403 | 权限不足 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |
| 1001 | 用户不存在 |
| 1002 | 企业钱包不存在 |
| 2001 | 发票抬头不存在 |
| 2002 | 发票抬头已存在 |
| 2003 | 默认抬头不能删除 |
| 3001 | 订单不存在 |
| 3002 | 订单不能开票 |
| 3003 | 订单已开票 |
| 4001 | 开票申请不存在 |
| 4002 | 开票申请状态错误 |